{"version":3,"file":"yup.module.js","sources":["../src/yup.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/ban-ts-comment */\nimport { Resolver, transformToNestObject, FieldValues } from 'react-hook-form';\nimport Yup from 'yup';\nimport Lazy from 'yup/lib/Lazy';\n\n/**\n * From 0.32.0, Yup add TypeScript support and `path` typing is optional that's why we have `@ts-expect-error`\n * FYI: `path`: a string, indicating where there error was thrown. `path` is empty at the root level.\n * react-hook-form's values are object so path is defined\n * https://github.com/jquense/yup#validationerrorerrors-string--arraystring-value-any-path-string\n */\nconst parseErrorSchema = (\n  error: Yup.ValidationError,\n  validateAllFieldCriteria: boolean,\n) => {\n  return Array.isArray(error.inner) && error.inner.length\n    ? error.inner.reduce(\n        (previous: Record<string, any>, { path, message, type }) => {\n          // @ts-expect-error\n          const previousTypes = (previous[path] && previous[path].types) || {};\n          const key = path || type;\n\n          return {\n            ...previous,\n            ...(key\n              ? {\n                  [key]: {\n                    ...(previous[key] || {\n                      message,\n                      type,\n                    }),\n                    ...(validateAllFieldCriteria\n                      ? {\n                          types: {\n                            ...previousTypes,\n                            // @ts-expect-error\n                            [type]: previousTypes[type]\n                              ? // @ts-expect-error\n                                [...[].concat(previousTypes[type]), message]\n                              : message,\n                          },\n                        }\n                      : {}),\n                  },\n                }\n              : {}),\n          };\n        },\n        {},\n      )\n    : {\n        // @ts-expect-error\n        [error.path]: { message: error.message, type: error.type },\n      };\n};\n\ntype ValidateOptions<T extends Yup.AnyObjectSchema> = Parameters<\n  T['validate']\n>[1];\n\nexport const yupResolver = <TFieldValues extends FieldValues>(\n  schema: Yup.AnyObjectSchema | Lazy<any, any>,\n  options: ValidateOptions<Yup.AnyObjectSchema> = {\n    abortEarly: false,\n  },\n): Resolver<TFieldValues> => async (\n  values,\n  context,\n  validateAllFieldCriteria = false,\n) => {\n  try {\n    if (options.context && process.env.NODE_ENV === 'development') {\n      // eslint-disable-next-line no-console\n      console.warn(\n        \"You should not used the yup options context. Please, use the 'useForm' context object instead\",\n      );\n    }\n    return {\n      values: await schema.validate(values, {\n        ...options,\n        context,\n      }),\n      errors: {},\n    };\n  } catch (e) {\n    const parsedErrors = parseErrorSchema(e, validateAllFieldCriteria);\n    return {\n      values: {},\n      errors: transformToNestObject(parsedErrors),\n    };\n  }\n};\n"],"names":["yupResolver","schema","options","abortEarly","values","context","validateAllFieldCriteria","process","env","NODE_ENV","console","warn","validate","errors","e","parsedErrors","error","Array","isArray","inner","length","reduce","previous","path","message","type","previousTypes","types","key","concat","parseErrorSchema","transformToNestObject"],"mappings":"uQAWA,IAiDaA,EAAc,SACzBC,EACAC,mBAAAA,IAAAA,EAAgD,CAC9CC,YAAY,aAGdC,EACAC,EACAC,YAAAA,IAAAA,GAA2B,uDAGrBJ,EAAQG,SAAoC,gBAAzBE,QAAQC,IAAIC,UAEjCC,QAAQC,KACN,iHAIYV,EAAOW,SAASR,OACzBF,GACHG,QAAAA,uBAHJ,MAAO,CACLD,SAIAS,OAAQ,4EAEHC,GACP,IAAMC,EA1Ee,SACvBC,EACAV,SAEA,OAAOW,MAAMC,QAAQF,EAAMG,QAAUH,EAAMG,MAAMC,OAC7CJ,EAAMG,MAAME,OACV,SAACC,aAAiCC,IAAAA,KAAMC,IAAAA,QAASC,IAAAA,KAEzCC,EAAiBJ,EAASC,IAASD,EAASC,GAAMI,OAAU,GAC5DC,EAAML,GAAQE,EAEpB,YACKH,EACCM,UAEGA,QACKN,EAASM,IAAQ,CACnBJ,QAAAA,EACAC,KAAAA,GAEEnB,EACA,CACEqB,WACKD,UAEFD,GAAOC,EAAcD,aAEd,GAAGI,OAAOH,EAAcD,KAAQD,IACpCA,OAGR,OAGR,KAGR,YAICR,EAAMO,MAAO,CAAEC,QAASR,EAAMQ,QAASC,KAAMT,EAAMS,SAiCnCK,CAAiBhB,EAAGR,GACzC,MAAO,CACLF,OAAQ,GACRS,OAAQkB,EAAsBhB,OA5BT"}