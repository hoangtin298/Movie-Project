{"version":3,"file":"vest.umd.js","sources":["../src/vest.ts"],"sourcesContent":["import { FieldValues, Resolver, transformToNestObject } from 'react-hook-form';\nimport * as Vest from 'vest';\n\ntype VestErrors = Record<string, string[]>;\n\ntype ICreateResult = ReturnType<typeof Vest.create>;\n\ntype Promisify = <T extends ICreateResult, K>(\n  fn: T,\n) => (args: K) => Promise<Vest.IVestResult>;\n\nconst promisify: Promisify = (validatorFn) => (...args) =>\n  new Promise((resolve) => validatorFn(...args).done(resolve as Vest.DoneCB));\n\nconst parseErrorSchema = (\n  vestError: VestErrors,\n  validateAllFieldCriteria: boolean,\n) => {\n  return Object.entries(vestError).reduce((prev, [key, value]) => {\n    return {\n      ...prev,\n      [key]: {\n        type: '',\n        message: value[0],\n        ...(validateAllFieldCriteria\n          ? {\n              types: value.reduce((prev, message, index) => {\n                return {\n                  ...prev,\n                  [index]: message,\n                };\n              }, {}),\n            }\n          : {}),\n      },\n    };\n  }, {});\n};\n\nexport const vestResolver = <TFieldValues extends FieldValues>(\n  schema: ICreateResult,\n  _: any = {},\n  validateAllFieldCriteria = false,\n): Resolver<TFieldValues> => async (values) => {\n  const validateSchema = promisify(schema);\n  const result = await validateSchema(values);\n  const errors = result.getErrors();\n\n  if (!result.hasErrors()) {\n    return { values: values as any, errors: {} };\n  }\n\n  return {\n    values: {},\n    errors: transformToNestObject(\n      parseErrorSchema(errors, validateAllFieldCriteria),\n    ),\n  };\n};\n"],"names":["parseErrorSchema","vestError","validateAllFieldCriteria","Object","entries","reduce","prev","value","type","message","types","index","schema","_","values","validateSchema","validatorFn","Promise","resolve","done","result","errors","getErrors","hasErrors","transformToNestObject"],"mappings":"6fAWA,IAGMA,EAAmB,SACvBC,EACAC,GAEA,OAAOC,OAAOC,QAAQH,GAAWI,OAAO,SAACC,WAAYC,OACnD,YACKD,mBAEDE,KAAM,GACNC,QAASF,EAAM,IACXL,EACA,CACEQ,MAAOH,EAAMF,OAAO,SAACC,EAAMG,EAASE,SAClC,YACKL,UACFK,GAAQF,OAEV,KAEL,SAGP,oBAGuB,SAC1BG,EACAC,EACAX,mBAAAA,IAAAA,GAA2B,YACOY,OAClC,IAAMC,GAjCsBC,EAiCKJ,wCAhC7BK,QAAQ,SAACC,UAAYF,iCAAqBG,KAAKD,8BAiC9BH,EAAeD,kBAA9BM,GACN,IAAMC,EAASD,EAAOE,mBAEjBF,EAAOG,YAIL,CACLT,OAAQ,GACRO,OAAQG,wBACNxB,EAAiBqB,EAAQnB,KANpB,CAAEY,OAAQA,EAAeO,OAAQ,MAVhB,kCA5BC,IAACL"}